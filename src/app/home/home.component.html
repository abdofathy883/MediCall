<section class="container py-5">
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <google-map [center]="center" [zoom]="zoom" width="100%" height="450px">
        <!-- User marker -->
        <map-marker
          *ngIf="myLocationMarker"
          [position]="myLocationMarker"
          [label]="'You'"
          [title]="'Your Location'"
          [icon]="{
            url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          }"
        ></map-marker>
        
        <!-- Nurse markers -->
        <map-marker
          *ngFor="let marker of nurseMarkers; let i = index"
          [position]="marker"
          [label]="nurses[i]?.firstName || 'Nurse'"
          [title]="(nurses[i]?.firstName || '') + ' ' + (nurses[i]?.lastName || '')"
          [icon]="{
            url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
          }"
        ></map-marker>
      </google-map>
    </div>
    
    <div class="col-md-6 col-sm-12 d-flex flex-column justify-content-center">
      <h1>احجز</h1>
      <p class="hero-text">
        احجز موعدك في ميدي كول بسهولة ويسر. اختر الخدمة المناسبة لك، وحدد تاريخ
        الزيارة، واملأ المعلومات الإضافية.
      </p>
      
      <!-- Error message display -->
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>
      
      <!-- Visit request form -->
      <form (ngSubmit)="onSubmit()" #visitForm="ngForm" *ngIf="!showNursesList">
        <!-- Service selection -->
        <div class="mb-3">
          <label for="services">اختر الخدمة</label>
          <select
            id="services"
            class="form-control"
            multiple
            required
            [(ngModel)]="request.serviceIds"
            name="serviceIds"
          >
            <option *ngFor="let service of services" [value]="service.id">
              {{ service.name }}
            </option>
          </select>
        </div>
        
        <!-- Date selection -->
        <div class="mb-3">
          <label for="scheduleDate">تاريخ الزيارة</label>
          <input
            type="date"
            id="scheduleDate"
            class="form-control"
            required
            [(ngModel)]="request.scheduledDate"
            name="scheduledDate"
          />
        </div>
        
        <!-- Submit button -->
        <button 
          type="submit" 
          class="btn form-btn mt-3" 
          [disabled]="isLoading || !visitForm.form.valid"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          احجز موعدك
        </button>
      </form>
      
      <!-- Nurses list after form submission -->
      <div *ngIf="showNursesList" class="nurses-list mt-3">
        <h3>الممرضين المتاحين</h3>
        
        <div *ngIf="nurses.length === 0" class="alert alert-info">
          لا يوجد ممرضين متاحين في الوقت الحالي
        </div>
        
        <div *ngFor="let nurse of nurses" class="card mb-3">
          <div class="card-body">
            <div class="row">
              <div class="col-3">
                <img 
                  [src]="nurse.profilePicture || 'assets/images/nurse-default.png'" 
                  class="img-fluid rounded-circle" 
                  alt="Nurse profile"
                >
              </div>
              <div class="col-9">
                <h5 class="card-title">{{ nurse.firstName }} {{ nurse.lastName }}</h5>
                <p class="card-text">خبرة: {{ nurse.experienceYears }} سنوات</p>
                <p class="card-text">عدد الزيارات: {{ nurse.visitCount }}</p>
                <button class="btn btn-primary" (click)="selectNurse(nurse)">اختيار</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Back button -->
        <button class="btn btn-secondary mt-3" (click)="showNursesList = false">
          العودة
        </button>
      </div>
    </div>
  </div>
</section>